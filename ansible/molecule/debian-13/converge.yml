---
- name: Converge
  hosts: all
  become: true
  vars:
    # Define default variables that your role needs
    wireguard_port: 51820
    wireguard_interface: wg0
    wireguard_address: "192.168.145.1/24"
    wireguard_tunnel_subnet: "192.168.145.0/24"
    wireguard_peer1: "192.168.145.2/32"
    wireguard_private_key_path: "/tmp/wireguard/privatekey"
    wireguard_public_key_path: "/tmp/wireguard/publickey"
    wireguard_config_path: "/tmp/wireguard/wg0.conf"
    user_name: "repository_owner"
    repo_url: "https://github.com/willquill/vps-proxy.git"
    repo_dest: "/tmp/vps-proxy"
    traefik_username: "testuser"
    traefik_password: "testpass"
    traefik_oidc_auth_secret: "testsecret"
    traefik_oidc_client_id: "testclientid"
    traefik_oidc_client_secret: "testclientsecret"
    maxmind_license_key: "testlicensekey"
    acme_email: "test@example.com"
    public_hostname: "example.com"
    cf_dns_api_token: "testtoken"
    cf_zone_api_token: "testtoken"
    timezone: "UTC"
  pre_tasks:
    # Create directories that might be needed
    - name: Ensure required directories exist
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
        mode: "0777"
      with_items:
        - /tmp/wireguard
        - /tmp/ansible-tmp
  tasks:
    # 'sed' is used to for role name replacement in the GitHub Action
    - name: "Include template role"
      ansible.builtin.include_role:
        name: "template"
